<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Perfil - StoryFrames</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link th:href="@{/css/card.css}" rel="stylesheet">
    <link th:href="@{/css/carousel.css}" rel="stylesheet">
    <link th:href="@{/css/general.css}" rel="stylesheet">
    <link th:href="@{/css/navbar.css}" rel="stylesheet">
    <link th:href="@{/css/modal.css}" rel="stylesheet">
    <link th:href="@{/css/dark.css}" rel="stylesheet">
    <link th:href="@{/css/footer.css}" rel="stylesheet">

</head>
<body>
<header th:replace="~{_layout :: navbar}"></header>

<main class="container mt-5 pt-5 mb-5">
    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6">
            <div class="card shadow-lg border-0 rounded-4">

                <div class="card-header bg-dark text-white rounded-top-4">
                    <h4 class="mb-0"><i class="bi bi-person-badge me-2"></i> Detalles de Mi Cuenta</h4>
                </div>

                <div class="card-body p-4">

                    <div th:object="${usuario}" class="row g-3">

                        <div class="col-12 text-center mb-4">
                            <i th:class="${usuario.rol == 'ADMIN'} ? 'bi bi-shield-fill-check text-danger' : 'bi bi-person-circle text-primary'"
                               style="font-size: 4rem;"></i>
                            <h3 th:text="*{nombre + ' ' + apellido}" class="mt-2 fw-bold"></h3>
                            <p class="text-muted">
                                Rol:
                                <span th:text="*{rol}"
                                      th:class="${usuario.rol == 'ADMIN'} ? 'badge bg-danger' : 'badge bg-success'">USER</span>
                            </p>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label fw-bold">Username</label>
                            <p class="form-control-plaintext border-bottom" th:text="*{username}"></p>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label fw-bold">Correo Electrónico</label>
                            <p class="form-control-plaintext border-bottom" th:text="*{correo}"></p>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label fw-bold">Fecha de Nacimiento</label>
                            <p class="form-control-plaintext border-bottom" th:text="*{fechaNacimiento}"></p>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label fw-bold">ID de Usuario</label>
                            <p class="form-control-plaintext border-bottom" th:text="*{id}"></p>
                        </div>

                        <div class="col-12 pt-3">
                            <a th:href="@{/editar-perfil}" class="btn btn-warning w-100">
                                <i class="bi bi-gear-fill me-1"></i> Editar Perfil / Configuración
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="text-center mt-4 d-flex justify-content-center gap-3">
                <a th:href="@{/logout}" class="btn btn-sm btn-outline-secondary">
                    <i class="bi bi-box-arrow-right me-1"></i> Cerrar Sesión
                </a>

                <button type="button" class="btn btn-sm btn-outline-danger" data-bs-toggle="modal" data-bs-target="#eliminarCuentaModal">
                    <i class="bi bi-trash me-1"></i> Eliminar Cuenta
                </button>
            </div>
        </div>
    </div>
</main>

<div class="modal fade" id="eliminarCuentaModal" tabindex="-1" aria-labelledby="eliminarCuentaModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="eliminarCuentaModalLabel"><i class="bi bi-exclamation-triangle-fill me-2"></i> Confirmar Eliminación</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p><strong>Estás a punto de eliminar tu cuenta permanentemente.</strong></p>
                <p>Esta acción no se puede deshacer. Perderás todos tus datos y configuraciones.</p>
                <p class="text-danger fw-bold">¿Estás absolutamente seguro de que deseas continuar?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <form th:action="@{/perfil/delete}" method="post" style="display: inline;">
                    <button type="submit" class="btn btn-danger">Sí, Eliminar Mi Cuenta</button>
                </form>
            </div>
        </div>
    </div>
</div>

<div th:replace="~{_layout :: footer}"></div>
<button id="toggleDarkMode" class="btn-darkmode">
    <i class="bi bi-moon"></i>
</button>
<script th:src="@{/js/dark.js}"></script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>