<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Mangas - StoryFrames Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <link th:href="@{/css/general.css}" rel="stylesheet">
    <link th:href="@{/css/navbar.css}" rel="stylesheet">
    <link th:href="@{/css/dark.css}" rel="stylesheet">
    <link th:href="@{/css/footer.css}" rel="stylesheet">
    <link th:href="@{/css/admin.css}" rel="stylesheet">
    <link th:href="@{/css/manga-management.css}" rel="stylesheet">
</head>
<body>

<header th:replace="~{_layout :: navbar}"></header>

<main class="container-fluid mt-5 pt-5 mb-5">
    <div class="row justify-content-center">
        <div class="col-12">
            <div class="d-flex justify-content-between flex-wrap align-items-center pt-3 pb-2 mb-4 border-bottom">
                <h1 class="h2 text-dark">
                    <i class="bi bi-journal-album me-2"></i> Gestión de Mangas
                </h1>
                <div class="btn-toolbar mb-2 mb-md-0">
                    <a th:href="@{/admin}" class="btn btn-sm btn-outline-secondary me-2">
                        <i class="bi bi-speedometer2 me-1"></i> Panel
                    </a>
                    <a th:href="@{/admin/mangas/new}" class="btn btn-sm btn-success">
                        <i class="bi bi-plus-circle me-1"></i> Añadir Nuevo Manga
                    </a>
                </div>
            </div>

            <div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show" role="alert">
                <span th:text="${successMessage}">Manga guardado/eliminado con éxito.</span>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            <div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show" role="alert">
                <span th:text="${errorMessage}">Error al realizar la operación.</span>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>

            <div class="table-responsive bg-white rounded-3 shadow-sm p-3">
                <table class="table table-striped table-hover align-middle">
                    <thead class="table-dark">
                    <tr>
                        <th>ID</th>
                        <th>Portada</th>
                        <th>Título</th>
                        <th>Autor</th>
                        <th>Género</th>
                        <th>Precio</th>
                        <th>Noticia</th>
                        <th>Acciones</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="manga : ${mangas}">
                        <td th:text="${manga.id}">1</td>
                        <td>
                            <img th:src="${manga.portada}" alt="Portada" class="img-fluid"
                                 onerror="this.onerror=null; this.src='https://placehold.co/50x75/EAEAEA/333?text=N/A';">
                        </td>
                        <td th:text="${manga.titulo}">One Piece</td>
                        <td th:text="${manga.autor != null ? manga.autor.nombre : 'N/A'}">Eiichiro Oda</td>
                        <td th:text="${manga.genero}">Shonen</td>
                        <td th:text="'S/ ' + ${#numbers.formatDecimal(manga.precio, 1, 2)}">S/ 15.00</td>
                        <td>
                            <i th:if="${manga.es_noticia}" class="bi bi-check-circle-fill text-success" title="Es Noticia"></i>
                            <i th:unless="${manga.es_noticia}" class="bi bi-x-circle-fill text-danger" title="No es Noticia"></i>
                        </td>
                        <td>
                            <a th:href="@{/admin/mangas/edit/{id}(id=${manga.id})}" class="btn btn-sm btn-warning me-1" title="Editar">
                                <i class="bi bi-pencil-square"></i>
                            </a>
                            <button type="button" class="btn btn-sm btn-danger"
                                    data-bs-toggle="modal"
                                    data-bs-target="#deleteModal"
                                    th:data-manga-id="${manga.id}"
                                    th:data-manga-titulo="${manga.titulo}"
                                    title="Eliminar">
                                <i class="bi bi-trash"></i>
                            </button>
                        </td>
                    </tr>
                    </tbody>
                </table>

                <div th:if="${mangas.isEmpty()}" class="alert alert-info text-center mt-3" role="alert">
                    No hay mangas registrados en la base de datos.
                </div>
            </div>
        </div>
    </div>
</main>

<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="deleteModalLabel">Confirmar Eliminación</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>¿Estás seguro de que deseas eliminar permanentemente el manga: <strong id="mangaTitulo"></strong>?</p>
                <p class="text-danger small">Esta acción no se puede deshacer y también eliminará todos sus capítulos asociados.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <form id="deleteForm" th:action="@{/admin/mangas/delete/{id}(id=0)}" method="post">
                    <button type="submit" class="btn btn-danger">
                        <i class="bi bi-trash me-1"></i> Eliminar
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<div th:replace="~{_layout :: footer}"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script th:src="@{/js/dark.js}"></script>
<script th:src="@{/js/manga-management.js}"></script>
<script>

</script>
</body>
</html>
