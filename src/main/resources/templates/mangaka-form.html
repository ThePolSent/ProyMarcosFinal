<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{_layout :: layout(~{::title}, ~{::styles}, ~{::section})}">
<head>
    <meta charset="UTF-8">
    <title th:fragment="title">[[${mangaka.id} == null ? 'Crear' : 'Editar']] Mangaka</title>
    <!-- Incluir estilos si el layout los requiere -->
    <th:block th:fragment="styles">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
        <!-- Asumo que los demás estilos base están en _layout -->
    </th:block>
</head>
<body>

<section th:fragment="section">
    <main class="container my-5">
        <h2 class="fw-bold text-dark mb-4">
            <i class="bi bi-person-fill-gear me-2"></i> [[${mangaka.id} == null ? 'Crear Nuevo' : 'Editar']] Mangaka
        </h2>

        <form th:action="@{/admin/mangakas/save}" th:object="${mangaka}" method="post" class="bg-white p-4 shadow-lg rounded-3">

            <input type="hidden" th:field="*{id}" />

            <div class="row g-3">
                <div class="col-md-6">
                    <label for="nombre" class="form-label">Nombre Completo</label>
                    <input type="text" th:field="*{nombre}" class="form-control" id="nombre" placeholder="Ej: Eiichiro Oda" required>
                    <div class="text-danger small mt-1" th:if="${#fields.hasErrors('nombre')}" th:errors="*{nombre}"></div>
                </div>

                <div class="col-md-6">
                    <label for="nacionalidad" class="form-label">Nacionalidad</label>
                    <input type="text" th:field="*{nacionalidad}" class="form-control" id="nacionalidad" placeholder="Ej: Japonés" required>
                    <div class="text-danger small mt-1" th:if="${#fields.hasErrors('nacionalidad')}" th:errors="*{nacionalidad}"></div>
                </div>

                <div class="col-md-6">
                    <label for="fecha_nacimiento" class="form-label">Fecha de Nacimiento</label>
                    <!-- Se establece max="" para ser limitado por JavaScript a la fecha de hoy -->
                    <input type="date" th:field="*{fecha_nacimiento}" class="form-control" id="fecha_nacimiento" required max="">
                    <div class="text-danger small mt-1" th:if="${#fields.hasErrors('fecha_nacimiento')}" th:errors="*{fecha_nacimiento}"></div>
                    <small class="form-text text-muted">La fecha no puede ser futura.</small>
                </div>

                <div class="col-md-6">
                    <label for="lugar_nacimiento" class="form-label">Lugar de Nacimiento</label>
                    <input type="text" th:field="*{lugar_nacimiento}" class="form-control" id="lugar_nacimiento" placeholder="Ej: Kumamoto, Japón">
                    <div class="text-danger small mt-1" th:if="${#fields.hasErrors('lugar_nacimiento')}" th:errors="*{lugar_nacimiento}"></div>
                </div>
            </div>

            <!-- Se eliminó el campo 'Edad' para forzar que la fecha de nacimiento sea la única fuente de edad. -->

            <div class="mb-3 mt-3">
                <label for="biografia" class="form-label">Biografía</label>
                <textarea th:field="*{biografia}" class="form-control" id="biografia" rows="5" placeholder="Una breve reseña sobre su vida y carrera." required></textarea>
                <div class="text-danger small mt-1" th:if="${#fields.hasErrors('biografia')}" th:errors="*{biografia}"></div>
            </div>

            <div class="mb-3">
                <label for="foto" class="form-label">URL de la Foto</label>
                <input type="url" th:field="*{foto}" class="form-control" id="foto" placeholder="URL de la imagen del mangaka">
                <div class="text-danger small mt-1" th:if="${#fields.hasErrors('foto')}" th:errors="*{foto}"></div>
            </div>

            <hr class="my-4">

            <div class="d-flex justify-content-between">
                <a th:href="@{/admin/mangakas}" class="btn btn-outline-secondary">
                    <i class="bi bi-arrow-left"></i> Cancelar
                </a>
                <button type="submit" class="btn btn-warning">
                    <i class="bi bi-save"></i> [[${mangaka.id} == null ? 'Guardar' : 'Actualizar']]
                </button>
            </div>
        </form>
    </main>
</section>

<!-- Incluir el script de Bootstrap si no está en _layout -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const fechaNacimientoInput = document.getElementById('fecha_nacimiento');

        // Obtener la fecha actual
        const hoy = new Date();

        // Función para formatear la fecha como YYYY-MM-DD (requerido por el input type="date")
        function formatDate(date) {
            const yyyy = date.getFullYear();
            // Los meses son base 0, por eso se suma 1
            const mm = String(date.getMonth() + 1).padStart(2, '0');
            const dd = String(date.getDate()).padStart(2, '0');
            return `${yyyy}-${mm}-${dd}`;
        }

        // Establecer el atributo 'max' a la fecha de hoy, impidiendo fechas futuras
        fechaNacimientoInput.setAttribute('max', formatDate(hoy));
    });
</script>
</body>
</html>